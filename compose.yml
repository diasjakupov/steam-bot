services:
  api:
    build: .
    environment:
      DATABASE_URL: sqlite+aiosqlite:////data/cs2bot.db
      STEAM_CURRENCY_ID: 1
      FLOAT_API_TIMEOUT: 300
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID}
      POLL_INTERVAL_S: 10
      COMBINED_FEE_RATE: 0.15
      COMBINED_FEE_MIN_CENTS: 1
    command: ["uvicorn", "src.api.main:app", "--host", "0.0.0.0", "--port", "8000"]
    ports:
      - "8000:8000"
    volumes:
      - sqlite-data:/data
      - ./html-dumps:/app/html-dumps
    networks:
      - app-network
  worker:
    build: .
    environment:
      DATABASE_URL: sqlite+aiosqlite:////data/cs2bot.db
      STEAM_CURRENCY_ID: 1
      FLOAT_API_TIMEOUT: 300
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID}
      POLL_INTERVAL_S: 10
      COMBINED_FEE_RATE: 0.15
      COMBINED_FEE_MIN_CENTS: 1
    command: ["python", "-m", "src.worker.main"]
    volumes:
      - sqlite-data:/data
      - ./html-dumps:/app/html-dumps
    networks:
      - app-network

volumes:
  sqlite-data:

networks:
  app-network:
    driver: bridge
